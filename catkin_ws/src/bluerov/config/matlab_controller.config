#!/usr/bin/env python
import roslib; roslib.load_manifest("bluerov")
from dynamic_reconfigure.parameter_generator_catkin import *

gen = ParameterGenerator()

# Controller list
controller_enum = gen.enum([
    gen.const("Manual",             int_t, 0, ""),
    gen.const("LQ",                 int_t, 1, ""),
], "An enum for controllers")

# Add Controller
#gen.add("controller", int_t, 0, "Choose which controller to use", 0, 0, 1, edit_method=controller_enum)
controllers_group = gen.add_group("controllers", state=True)
controllers_group.add("controller", int_t, 0, "Choose which controller to use", 0, 0, 1, edit_method=controller_enum)

pid_group = controllers_group.add_group("Pid_parameters", type="collapse", state=True)
#pid_group = gen.add_group("Pid_parameters", type="collapse", state=True)
pid_group.add("P_angular_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_angular_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_angular_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_angular_vel_x",   double_t, 0, "", 1.0, 1.0, 100)

pid_group.add("P_angular_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_angular_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_angular_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_angular_vel_y",   double_t, 0, "", 1.0, 1.0, 100)

pid_group.add("P_angular_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_angular_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_angular_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_angular_vel_z",   double_t, 0, "", 1.0, 1.0, 100)

pid_group.add("P_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_vel_x",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_vel_x",   double_t, 0, "", 1.0, 1.0, 100)

pid_group.add("P_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_vel_y",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_vel_y",   double_t, 0, "", 1.0, 1.0, 100)

pid_group.add("P_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("I_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("D_vel_z",   double_t, 0, "", 0.5, 0.1, 20)
pid_group.add("N_vel_z",   double_t, 0, "", 1.0, 1.0, 100)

linear_max = 10
decoupler_group = controllers_group.add_group("Decoupler settings",type="collapse", state=True)
decoupler_group.add("front_strafe_decouple",   double_t, 0, "scales power of front vertical thrusters during strafe movement", 0.5, -1, 1)
decoupler_group.add("front_forward_decouple",   double_t, 0, "scales power of front vertical thrusters during forward movement", -0.13, -1, 1)
decoupler_group.add("front_pitch_bias",   double_t, 0, "scales power of front vertical thrusters during pitch", 0.5, 0, 1)
decoupler_group.add("front_vertical_bias",   double_t, 0, "scales power of front vertical thrusters during ascent/descent", 0.75, 0, 1)
decoupler_group.add("buoyancy_control",   double_t, 0, "applies a constant vertical force in m/s", 0, -linear_max, linear_max)

acc_int_group = controllers_group.add_group("Acc integration settings", type="collapse", state=True)
acc_int_group.add("alpha", double_t, 0, "y[n] + alpha*y[n-1] = x[n]", 0, 0, 10)
acc_int_group.add("enable_integration", bool_t, 0, "", False)


onoff_enum = gen.enum([ gen.const("ON",      int_t, 0, "Turn on test"),
                       gen.const("OFF",     int_t, 1, "Turn off test")],
                     "An enum to set on/off for tests")

# Options for telegraph generator
telegraph_group = gen.add_group("telegraph_signal", type="collapse", state=True)
telegraph_group.add("test", int_t, 0, "Set the test signal on/off", 1, 0, 1, edit_method=onoff_enum)

thruster1_group = telegraph_group.add_group("Thruster1", type="collapse", state=True)
thruster1_group.add("switch_factor1", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster1_group.add("max_scale1", double_t, 0 , "Max scale", 1, 0, 1)
thruster1_group.add("min_scale1", double_t, 0 , "Min scale", 1, 0, 1)

thruster2_group = telegraph_group.add_group("Thruster2", type="collapse", state=True)
thruster2_group.add("switch_factor2", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster2_group.add("max_scale2", double_t, 0 , "Max scale", 1, 0, 1)
thruster2_group.add("min_scale2", double_t, 0 , "Min scale", 1, 0, 1)

thruster3_group = telegraph_group.add_group("Thruster3", type="collapse", state=True)
thruster3_group.add("switch_factor3", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster3_group.add("max_scale3", double_t, 0 , "Max scale", 1, 0, 1)
thruster3_group.add("min_scale3", double_t, 0 , "Min scale", 1, 0, 1)

thruster4_group = telegraph_group.add_group("Thruster4", type="collapse", state=True)
thruster4_group.add("switch_factor4", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster4_group.add("max_scale4", double_t, 0 , "Max scale", 1, 0, 1)
thruster4_group.add("min_scale4", double_t, 0 , "Min scale", 1, 0, 1)

thruster5_group = telegraph_group.add_group("Thruster5", type="collapse", state=True)
thruster5_group.add("switch_factor5", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster5_group.add("max_scale5", double_t, 0 , "Max scale", 1, 0, 1)
thruster5_group.add("min_scale5", double_t, 0 , "Min scale", 1, 0, 1)

thruster6_group = telegraph_group.add_group("Thruster6", type="collapse", state=True)
thruster6_group.add("switch_factor6", int_t, 0 , "Chance to switch", 50, 0, 100)
thruster6_group.add("max_scale6", double_t, 0 , "Max scale", 1, 0, 1)
thruster6_group.add("min_scale6", double_t, 0 , "Min scale", 1, 0, 1)


# Options for the sensorfusion module and its sub-modules
sensor_fusion_group = gen.add_group("Sensor fusion settings", type="collapse", state=True)
sensor_fusion_group.add("Sample_time", double_t, 0, "sample time in seconds for motion model",1,0.000001,30)
sensor_fusion_group.add("g", double_t, 0, "Gravitational constant",9.82,8,11)


acc_group = sensor_fusion_group.add_group("Accceleration settings",type="collapse", state=True)
acc_group.add('enable_acceleration', bool_t, 0,"",True)
acc_group.add("eps_acc", double_t, 0, "maximum difference between measured acceleration and g [m/s^2]",2,0,10)
acc_group.add("r_acc_11", double_t, 0, "covariance for acceleration measurement in x",10, 0.001,100)
acc_group.add("r_acc_22", double_t, 0, "covariance for acceleration measurement in x",10, 0.001,100)
acc_group.add("r_acc_33", double_t, 0, "covariance for acceleration measurement in x",10, 0.001,100)

mag_group = sensor_fusion_group.add_group("mag_options",type="collapse", state=True)
mag_group.add('enable_magnetometer', bool_t, 0,"",True)
mag_group.add("eps_mag", double_t, 0, "maximum difference between measured magnetic field and earths magnetic field [uTesla]",100,0,1000)
mag_group.add("r_mag_11", double_t, 0, "covariance for magnetometer measurement in x",30, 0.001,300)
mag_group.add("r_mag_22", double_t, 0, "covariance for magnetometer measurement in x",30, 0.001,300)
mag_group.add("r_mag_33", double_t, 0, "covariance for magnetometer measurement in x",30, 0.001,300)


pressure_group = sensor_fusion_group.add_group("Pressure_options",type="collapse", state=True)
pressure_group.add("enable_pressure", bool_t, 0,"",True)
pressure_group.add("x_offset", double_t, 0, "offset of rear pressure sensor in negative x direction [meters]",0.10,0,1)
pressure_group.add("Rho", double_t, 0,"Density of water in kg/m3",1000,900,1100)
pressure_group.add("r_pressure", double_t, 0, "covariance for pressure measurement",10, 0.001,100)



# generate the config headers
exit(gen.generate("bluerov", "matlab_controller", "matlab_controller"))
